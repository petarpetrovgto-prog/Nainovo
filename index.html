<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Range Trainer vT7</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f1520; --panel2:#101827; --border:#223047; --text:#e7ecf3;
    --FOLD:#f4f6fa; --L-F-F:#a7e8a7; --L-C-F:#155d15; --L-C-AI:#bcdcf3; --L-R-AI:#0b3a94;
    --MR-F-F:#ffe27a; --MR-C-AI:#7b4a2a; --MR-4B-AI:#e44747; --SHOVE:#6d4b8e;
    --ok:#1f9d55; --err:#d64545;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.35 -apple-system,system-ui,Segoe UI,Roboto,Arial}
  .top{position:sticky;top:0;z-index:30;display:flex;justify-content:space-between;align-items:center;
       padding:6px 8px;background:var(--panel2);border-bottom:1px solid var(--border)}
  .chip{padding:3px 8px;border:1px solid var(--border);border-radius:999px;background:#0f1624;font-size:12px}
  .btn{border:1px solid var(--border);background:#0f1624;color:var(--text);border-radius:12px;
       padding:10px 14px;font-weight:800;cursor:pointer}
  .wrap{max-width:1100px;margin:0 auto;padding:10px}
  .grid{display:grid;gap:10px}
  @media(min-width:980px){.grid{grid-template-columns:1.1fr 0.9fr}}
  .card{border:1px solid var(--border);background:#0f1624;border-radius:14px;padding:12px}
  .card h3{margin:0 0 8px;font-size:16px;display:flex;align-items:center;justify-content:space-between}
  .toggle{font-size:12px;opacity:.9}
  .hidden{display:none}

  .qTop{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
  .qHand{font-size:26px;font-weight:900}

  /* –¥–µ–π—Å—Ç–≤–∏—è */
  .actionsGrid{
    display:grid;
    grid-template-columns:repeat(3, minmax(0,1fr));
    gap:10px;
  }
  .actBtn{
    position:relative;border:2px solid rgba(0,0,0,.18);border-radius:13px;
    padding:16px 10px;font-size:16px;font-weight:1000;letter-spacing:.3px;
    color:#000; box-shadow:0 4px 14px rgba(0,0,0,.25);
    transform:translateY(0); transition:transform .06s ease, filter .06s ease, box-shadow .06s ease;
  }
  .actBtn:active{transform:translateY(1px); filter:brightness(.96)}
  .actBtn.ok{box-shadow:0 0 0 3px rgba(31,157,85,.55)}
  .actBtn.err{box-shadow:0 0 0 3px rgba(214,69,69,.55)}
  .actBtn .lbl{display:block;white-space:normal;overflow-wrap:anywhere;line-height:1.05;}
  .tag{position:absolute;right:8px;top:6px;font-size:11px;opacity:.7;color:#000}

  /* keypad */
  .disp{margin:4px 0 8px;border:2px solid var(--border);background:#0b1220;border-radius:10px;padding:10px;
        font-weight:900;text-align:center}
  .disp.ok{border-color:var(--ok); box-shadow:0 0 0 3px rgba(31,157,85,.45)}
  .disp.err{border-color:var(--err); box-shadow:0 0 0 3px rgba(214,69,69,.45)}
  .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .key{border:1px solid var(--border);background:#111a2b;border-radius:12px;padding:16px 0;font-weight:900;font-size:20px}
  .key.wide{grid-column:span 2}

  .feedback{margin-top:10px;font-weight:900}
  .ok{color:var(--ok)} .err{color:var(--err)}
  .resRow{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px 10px;
          border:1px dashed #2a3b58;border-radius:10px;margin-top:8px}
  .val{font-weight:900;padding:6px 8px;border-radius:8px;min-width:96px;text-align:center}

  /* –ñ–æ–∫–µ—Ä –ø–∞–Ω–µ–ª */
  #jokerPanel{margin-top:10px}
  #jokerTabs{display:flex;gap:6px;margin-bottom:6px}
  #jokerTabs button{flex:1;padding:6px;font-weight:800;border-radius:8px;cursor:pointer}
  #jokerContent{border:1px solid var(--border);border-radius:10px;overflow:hidden}

  .jokerTable{display:grid;grid-template-columns:repeat(13,1fr);font-size:10px;text-align:center}
  .jokerTable div{padding:3px 2px;border:1px solid #222;font-weight:700}

  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
  .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:#0f1624;
         border-radius:999px;padding:6px 10px;font-weight:800;cursor:pointer}
  .badge input{accent-color:#4da3ff}
  .mini{font-size:12px;opacity:.8}
  .sep{height:1px;background:#223047;margin:10px 0}
</style>
</head>
<body>
<div class="top">
  <div>
    <span class="chip">Q: <b id="qCount">0</b></span>
    <span class="chip">‚úî: <b id="qRight">0</b></span>
    <span class="chip">üî•: <b id="streak">0</b></span>
  </div>
  <div>
    <button class="btn" id="btnEdit">–†–µ–¥–∞–∫—Ç–æ—Ä</button>
    <button class="btn" id="btnData">Import/Export</button>
  </div>
</div>

<div class="wrap grid">
  <div class="card">
    <h3>–¢–µ—Å—Ç</h3>
    <div class="qTop">
      <div class="qHand" id="qHand">‚Äî</div>
      <div id="qStack">–°—Ç–∞–∫: ‚Äî</div>
      <div id="qPos">–ü–æ–∑–∏—Ü–∏—è: ‚Äî</div>
    </div>
    <div id="ansArea"></div>
    <div id="feedback" class="feedback"></div>
    <div id="correctRow" class="resRow" style="display:none">
      <div>–ü—Ä–∞–≤–∏–ª–µ–Ω:</div>
      <div id="correctVal" class="val">‚Äî</div>
    </div>
    <!-- –ñ–æ–∫–µ—Ä -->
    <div id="jokerPanel" class="hidden">
      <div id="jokerTabs">
        <button data-type="table">–¢–∞–±–ª–∏—Ü–∞</button>
        <button data-type="list">–°–ø–∏—Å—ä–∫</button>
        <button data-type="text">–¢–µ–∫—Å—Ç</button>
      </div>
      <div id="jokerContent"></div>
    </div>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="btnCheck" class="btn" style="flex:1;font-weight:900">–ü—Ä–æ–≤–µ—Ä–∏</button>
      <button id="btnNext" class="btn" style="flex:1;font-weight:900">–°–ª–µ–¥–≤–∞—â</button>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="card" id="settingsCard">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ <button id="toggleSettings" class="btn toggle">–°–∫—Ä–∏–π</button></h3>
    <div class="mini">–ü–æ–∑–∏—Ü–∏–∏:</div>
    <div id="posFilters" class="row"></div>
    <div class="sep"></div>
    <div class="mini">–°—Ç–∞–∫ –¥–∏–∞–ø–∞–∑–æ–Ω–∏:</div>
    <div id="stkFilters" class="row"></div>
    <div class="sep"></div>
    <div class="row">
      <button id="btnStart" class="btn" style="flex:1;font-weight:900">–°—Ç–∞—Ä—Ç</button>
      <button id="btnResetScore" class="btn" style="flex:1;font-weight:900">–ù—É–ª–∏—Ä–∞–π</button>
    </div>
  </div>
</div>

<script>
(function(){
  const COLORS={"FOLD":"#f4f6fa","L-F-F":"#a7e8a7","L-C-F":"#155d15","L-C-AI":"#bcdcf3","L-R-AI":"#0b3a94","MR-F-F":"#ffe27a","MR-C-AI":"#7b4a2a","MR-4B-AI":"#e44747","SHOVE":"#6d4b8e"};
  const norm=s=>(s||"").toUpperCase().replace(/\s+/g,"");
  const isPushPos=p=>/PUSH/i.test(p);
  const alias=(k,a)=>({d:a,c:COLORS[norm(a)]||null});
  function resolveDisplay(k,a){const ali=alias(k,a);return{text:ali.d,color:ali.c||COLORS[norm(a)]||""};}

  const POS_LIST=["HUSB","BU","HUBB_L","HUBB_MR","HUBBv_PUSH","SBvsBU","SBvsBU_PUSH","SBvsBB","BBvsBU_MR","BBvsBU_PUSH","BBvsSB_L","BBvsSB_MR","BBvsSB_PUSH"];
  const STKS=["0‚Äì4","4‚Äì7","7‚Äì10","10‚Äì13","13+"];
  const HANDS=`AA KK QQ JJ TT 99 88 77 66 55 44 33 22
  AKs AKo AQs AQo AJs AJo ATs ATo A9s A9o A8s A8o A7s A7o A6s A6o
  A5s A5o A4s A4o A3s A3o A2s A2o
  KQs KQo KJs KJo KTs KTo K9s K9o K8s K8o K7s K7o K6s K6o
  QJs QJo QTs QTo Q9s Q9o Q8s Q8o Q7s Q7o Q6s Q6o
  JTs JTo J9s J9o J8s J8o J7s J7o
  T9s T9o T8s T8o T7s T7o
  98s 98o 97s`.trim().split(/\s+/);

  let DB=JSON.parse(localStorage.getItem("qt_trainer_v7")||"{}");
  const save=()=>localStorage.setItem("qt_trainer_v7",JSON.stringify(DB));
  const k=(p,r)=>p+"||"+r, get=(p,r)=>DB[k(p,r)]?.raw||"";
  let curQ=null,count=0,right=0,streak=0,numBuf="",lastPressedBtn=null;

  function askNew(){
    const pos=POS_LIST[Math.floor(Math.random()*POS_LIST.length)];
    const stk=STKS[Math.floor(Math.random()*STKS.length)];
    const hand=HANDS[Math.floor(Math.random()*HANDS.length)];
    curQ={pos,stk,hand}; numBuf=""; lastPressedBtn=null;
    document.getElementById("qHand").textContent=hand;
    document.getElementById("qStack").textContent="–°—Ç–∞–∫: "+stk;
    document.getElementById("qPos").textContent="–ü–æ–∑–∏—Ü–∏—è: "+pos;
    document.getElementById("feedback").textContent="";
    document.getElementById("correctRow").style.display="none";
    document.getElementById("jokerPanel").classList.add("hidden");
    renderAnswerUI();
  }
  function renderAnswerUI(){
    const a=document.getElementById("ansArea");a.innerHTML="";
    if(isPushPos(curQ.pos)){
      const disp=document.createElement("div");disp.className="disp";disp.id="numDisp";disp.textContent="–í—ä–≤–µ–¥–∏ —á–∏—Å–ª–æ";
      const grid=document.createElement("div");grid.className="keypad";
      ["7","8","9","4","5","6","1","2","3",".","0","‚Üê"].forEach(k=>{
        const b=document.createElement("button");b.className="key";b.textContent=k;b.onclick=()=>{if(k==="‚Üê"){numBuf=numBuf.slice(0,-1);}else{numBuf+=k;}disp.textContent=numBuf;};grid.appendChild(b);
      });
      a.appendChild(disp);a.appendChild(grid);
    }else{
      const g=document.createElement("div");g.className="actionsGrid";
      Object.keys(COLORS).forEach(act=>{
        const b=document.createElement("button");b.className="actBtn";
        const d=resolveDisplay(curQ.pos,act);
        b.style.background=d.color; b.innerHTML=`<span class="lbl">${d.text}</span>`;
        b.onclick=()=>{lastPressedBtn=b;checkAnswer(false,act);};
        g.appendChild(b);
      });
      a.appendChild(g);
    }
  }
  function compute(pos,hand,stk){
    const raw=get(pos,stk);if(!raw)return{disp:"‚Äî",isNum:isPushPos(pos)};
    const lines=raw.split(/\n/).map(l=>l.trim()).filter(Boolean);
    let map={},def=null;lines.forEach(l=>{const[m,v]=l.split("=").map(x=>x.trim());if(/^default$/i.test(m))def=v;else map[m]=v;});
    return{disp:map[hand]||def||"‚Äî",isNum:isPushPos(pos)};
  }
  function checkAnswer(_,chosenAct){
    const res=compute(curQ.pos,curQ.hand,curQ.stk);
    const fb=document.getElementById("feedback"),cRow=document.getElementById("correctRow"),cVal=document.getElementById("correctVal");
    if(res.disp==="‚Äî"){fb.textContent="–ù—è–º–∞ –¥–∞–Ω–Ω–∏";return;}
    count++;let ok=false;if(res.isNum){ok=numBuf===res.disp;}else{ok=chosenAct===res.disp;}
    if(ok){right++;streak++;fb.textContent="–í–Ø–†–ù–û";fb.className="feedback ok";}else{streak=0;fb.textContent="–ì–†–ï–®–ù–û";fb.className="feedback err";}
    document.getElementById("qCount").textContent=count;document.getElementById("qRight").textContent=right;document.getElementById("streak").textContent=streak;
    cRow.style.display="flex";cVal.textContent=res.disp;
    showJoker(curQ.pos,curQ.stk);
  }

  // --- –ñ–æ–∫–µ—Ä –ø–∞–Ω–µ–ª ---
  const JOKER_KEY="jokerType";
  let jokerType=localStorage.getItem(JOKER_KEY)||"table";
  document.querySelectorAll("#jokerTabs button").forEach(b=>b.onclick=()=>{jokerType=b.dataset.type;localStorage.setItem(JOKER_KEY,jokerType);showJoker(curQ.pos,curQ.stk);});
  function showJoker(pos,stk){
    const cont=document.getElementById("jokerContent");cont.innerHTML="";
    document.getElementById("jokerPanel").classList.remove("hidden");
    if(jokerType==="table"){
      const grid=document.createElement("div");grid.className="jokerTable";
      HANDS.forEach(h=>{
        const res=compute(pos,h,stk);
        const cell=document.createElement("div");cell.textContent=h;
        cell.style.background=COLORS[norm(res.disp)]||"#333";grid.appendChild(cell);
      });
      cont.appendChild(grid);
    }
    if(jokerType==="list"){
      HANDS.forEach(h=>{
        const res=compute(pos,h,stk);
        const d=document.createElement("div");d.textContent=h+" = "+res.disp;cont.appendChild(d);
      });
    }
    if(jokerType==="text"){
      cont.textContent="–ó–∞–ø–æ–º–Ω–∏ —Ç–æ–∑–∏ —Å–ø–æ—Ç —á—Ä–µ–∑ –≥—Ä—É–ø–∏—Ä–∞–Ω–µ: –ø—Ä–µ–º–∏—É–º = AI, broadways = 3–±–µ—Ç, –º–∞–ª–∫–∏ = fold.";
    }
  }

  document.getElementById("btnStart").onclick=()=>{count=right=streak=0;askNew();};
  document.getElementById("btnNext").onclick=askNew;
  document.getElementById("btnCheck").onclick=()=>checkAnswer(false);
})();
</script>
</body>
</html>
